<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-cn" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.115.1">
<link rel="canonical" type="text/html" href="https://x-windy.github.io/blog/java/">
<link rel="alternate" type="application/rss&#43;xml" href="https://x-windy.github.io/blog/java/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Java | x-windy</title>
<meta name="description" content="A Docsy example site">
<meta property="og:title" content="Java" />
<meta property="og:description" content="A Docsy example site" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://x-windy.github.io/blog/java/" />
<meta itemprop="name" content="Java">
<meta itemprop="description" content="A Docsy example site"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Java"/>
<meta name="twitter:description" content="A Docsy example site"/>




<link rel="preload" href="/scss/main.min.6176d7d472a139a502a7c863de9bb7b87ef1ec9c271ff8f3d8ba4d983491b9ac.css" as="style">
<link href="/scss/main.min.6176d7d472a139a502a7c863de9bb7b87ef1ec9c271ff8f3d8ba4d983491b9ac.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.3.min.js"
  integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
  crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-00000000-0"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'UA-00000000-0');
}
</script>
  </head>
  <body class="td-section td-blog">
    <header>
      <nav class="td-navbar navbar-dark js-navbar-scroll">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="navbar-brand__name">x-windy</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="/blog/"><span>博客</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/docs/"><span>文档</span></a>
      </li>
      <li class="nav-item dropdown d-none d-lg-block">
        <div class="dropdown">
  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">中文</a>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="/en/blog/java/">English</a></li>
    <li><a class="dropdown-item" href="/ja/blog/java/">日本語</a></li>
    </ul>
</div></li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search">
  <div class="td-search__icon"></div>
  <input type="search" class="td-search__input form-control td-search-input" placeholder="站内搜索…" aria-label="站内搜索…" autocomplete="off">
</div>

  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
这是本节的多页打印视图。
<a href="#" onclick="print();return false;">点击此处打印</a>.
</p><p>
<a href="/blog/java/">返回本页常规视图</a>.
</p>
</div>



<h1 class="title">Java</h1>





    <ul>
    
  
  
  
  

  
    
    
	

    <li><a href="#pg-56e9ef72b11f59a2900fa303cdbeb59d"></a></li>



    
  
    
    
	

    <li><a href="#pg-41c0b0c1bf0ec7e293777a805b410293"></a></li>



    
  
    
    
	

    <li><a href="#pg-0106f5d1f87398d63e0cd20c3a0efd16">JWT</a></li>



    
  
    
    
	

    <li><a href="#pg-afd7f7b25840af8cd0e8d313baea0879">RESTful</a></li>



    
  
    
    
	

    <li><a href="#pg-ab3aaaa7b66c7c4bce279dd87d4ef870">ruoyi</a></li>



    
  
    
    
	

    <li><a href="#pg-ce94205a00302c2292e49c3c5d0504d5">SpringSecurity</a></li>



    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    


  

<div class="td-content" style="">
    <h1 id="pg-56e9ef72b11f59a2900fa303cdbeb59d"></h1>
	
	<div class="td-byline mb-4">
		
        
	</div>
	<h1 id="java">Java</h1>
<ol>
<li>JavaSE</li>
<li>JavaEE</li>
<li>SSM</li>
<li>Spring Boot</li>
<li>Spring Cloud</li>
</ol>
<h2 id="javase">JavaSE</h2>
<blockquote>
<p>Java标准版(Java Standard Edition)</p>
<p>使用于桌面应用程序和小型服务器应用程序的Java平台</p>
<p>是Java技术的核心和基础，包含了Java语言核心库、Java虚拟机（JVM）和Java开发工具包（JDK）</p>
</blockquote>
<ol>
<li>开发环境搭建(JDK安装、集成开发环境IDEA使用)</li>
<li>Java基础</li>
<li>Java进阶</li>
<li>数据结构和算法</li>
</ol>
<h3 id="面向对象oop">面向对象(OOP)</h3>
<h3 id="反射机制reflection">反射机制(Reflection)</h3>
<h3 id="注解annotation">注解(Annotation)</h3>
<h3 id="异常exception">异常(Exception)</h3>
<h2 id="javaee">JavaEE</h2>
<blockquote>
<p>Java企业版(Java Enterprise Edition)</p>
<p>使用于企业级应用程序开发的Java平台</p>
<p>JavaEE扩展了JavaSE，包含<code>Java Servlet、JavaServer Pages（JSP）、Java Messaging Service（JMS）、Java Persistence API（JPA）</code>等</p>
<p>JavaEE还提供了企业级容器，如<strong>Web容器</strong>等</p>
</blockquote>
<h3 id="web项目">Web项目</h3>
<p><strong>Web项目结构：</strong></p>
<p><code>src</code>：存放Java代码</p>
<p><code>web</code>：存放静态资源(html、css、js)和jsp</p>
<p><code>WEB-INF</code>：不能够被浏览器直接访问</p>
<p><code>WEB-INF/lib</code>：存放jar包</p>
<p><code>WEB-INF/web.xml</code>：web项目的核心配置文件</p>
<p><strong>三层开发结构：</strong></p>
<p><code>dao/mapper</code>：<strong>数据访问层</strong>，增删改查，**不涉及业务逻辑，只是达到按某个条件获得指定数据的要求。**向数据库发送SQL语句</p>
<p>`entity：实体类(Java对象)</p>
<p><code>service</code>：处理业务逻辑，<strong>需要先写一个接口(接口声明抽象方法)，然后再去实现(实现类实现具体方法)</strong></p>
<p><code>servlet/controller</code>：负责请求响应的控制</p>
<h4 id="tomcat">Tomcat</h4>
<p><strong>Tomcat的文件目录：</strong></p>
<p><code>bin</code>：可执行文件</p>
<p><code>conf</code>：配置文件</p>
<p><code>lib</code>：tomcat依赖的包</p>
<p><code>logs</code>：日志文件</p>
<p><code>temp</code>：临时文件</p>
<p><code>webapps</code>：存放web项目的地方</p>
<p><code>work</code>：运行时的数据</p>
<h5 id="servlet">Servlet</h5>
<h5 id="jsp">Jsp</h5>
<h5 id="el表达式">EL表达式</h5>
<h5 id="jstl标签库">Jstl标签库</h5>
<h2 id="ssm">SSM</h2>
<blockquote>
<p>Spring+SpringMVC+MyBatis</p>
</blockquote>
<h2 id="spring-boot">Spring Boot</h2>
<p><code>src/main/java/</code>结构</p>
<blockquote>
<p>存放项目Java源代码</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>|_annotation：放置项目自定义注解
</span></span><span style="display:flex;"><span>|_aspect：放置切面代码
</span></span><span style="display:flex;"><span>|_config：放置配置类
</span></span><span style="display:flex;"><span>|_constant：放置常量、枚举等定义
</span></span><span style="display:flex;"><span>   |__consist：存放常量定义
</span></span><span style="display:flex;"><span>   |__enums：存放枚举定义
</span></span><span style="display:flex;"><span>|_controller：放置控制器代码
</span></span><span style="display:flex;"><span>|_filter：放置一些过滤、拦截相关的代码
</span></span><span style="display:flex;"><span>|_mapper：放置数据访问层代码接口
</span></span><span style="display:flex;"><span>|_model：放置数据模型代码
</span></span><span style="display:flex;"><span>   |__entity：放置数据库实体对象定义
</span></span><span style="display:flex;"><span>   |__dto：存放数据传输对象定义
</span></span><span style="display:flex;"><span>   |__vo：存放显示层对象定义
</span></span><span style="display:flex;"><span>|_service：放置具体的业务逻辑代码（接口和实现分离）
</span></span><span style="display:flex;"><span>   |__intf：存放业务逻辑接口定义
</span></span><span style="display:flex;"><span>   |__impl：存放业务逻辑实际实现
</span></span><span style="display:flex;"><span>|_utils：放置工具类和辅助代码
</span></span></code></pre></div><p><code>/src/main/resources</code>结构</p>
<blockquote>
<p>放静态配置文件和页面静态资源等东西</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>|_mapper：存放mybatis的XML映射文件（如果是mybatis项目）
</span></span><span style="display:flex;"><span>|_static：存放网页静态资源，比如下面的js/css/img
</span></span><span style="display:flex;"><span>   |__js：
</span></span><span style="display:flex;"><span>   |__css：
</span></span><span style="display:flex;"><span>   |__img：
</span></span><span style="display:flex;"><span>   |__font：
</span></span><span style="display:flex;"><span>   |__等等
</span></span><span style="display:flex;"><span>|_template：存放网页模板，比如thymeleaf/freemarker模板等
</span></span><span style="display:flex;"><span>   |__header
</span></span><span style="display:flex;"><span>   |__sidebar
</span></span><span style="display:flex;"><span>   |__bottom
</span></span><span style="display:flex;"><span>   |__XXX.html等等
</span></span><span style="display:flex;"><span>|_application.yml       基本配置文件
</span></span><span style="display:flex;"><span>|_application-dev.yml   开发环境配置文件
</span></span><span style="display:flex;"><span>|_application-test.yml  测试环境配置文件
</span></span><span style="display:flex;"><span>|_application-prod.yml  生产环境配置文件
</span></span></code></pre></div><p><code>DTO/VO/DO</code>等<strong>数据模型定义</strong>的区分：</p>
<ul>
<li>
<p><code>DO（Data Object）</code>：与数据库表结构一一对应，通过DAO层向上传输数据源对象。<strong>服务层与DAO层之间数据传输的对象</strong></p>
</li>
<li>
<p><code>DTO（Data Transfer Object）</code>：数据传输对象，Service或Manager向外传输的对象。<strong>控制层与服务层之间数据传输的对象</strong></p>
</li>
<li>
<p><code>BO（Business Object）</code>：业务对象。由Service层输出的封装业务逻辑的对象。</p>
</li>
<li>
<p><code>AO（Application Object）</code>：应用对象。在Web层与Service层之间抽象的复用对象模型，极为贴近展示层，复用度不高。</p>
</li>
<li>
<p><code>VO（View Object）</code>：显示层对象，通常是Web向模板渲染引擎层传输的对象。</p>
</li>
<li>
<p><code>Query</code>：数据查询对象，各层接收上层的查询请求。注意超过2个参数的查询封装，禁止使用Map类来传输。</p>
<p>注意事项：</p>
<p>1、<code>Contorller</code>层参数传递建议不要使用<code>HashMap</code>，建议使用<strong>数据模型</strong>定义</p>
<p>2、<code>Controller</code>层里可以做<strong>参数校验、异常抛出</strong>等操作，但建议不要放太多业务逻辑，业务逻辑尽量放到<code>Service</code>层代码中去做</p>
<p>3、<code>Service</code>层做实际业务逻辑，可以按照功能模块做好定义和区分，相互可以调用</p>
<p>4、功能模块<code>Service</code>之间引用时，建议不要渗透到<code>DAO</code>层（或者<code>mapper</code>层），基于<code>Service</code>层进行调用和复用比较合理</p>
<p>5、业务逻辑层<code>Service</code>和数据库<code>DAO</code>层的操作对象不要混用。<code>Controller</code>层的数据对象不要直接渗透到<code>DAO</code>层（或者<code>mapper</code>层）；同理数据表实体对象<code>Entity</code>也不要直接传到<code>Controller</code>层进行输出或展示。</p>
</li>
</ul>
<h2 id="spring-cloud">Spring Cloud</h2>
<h2 id="其它">其它</h2>
<h3 id="javame">JavaME</h3>
<blockquote>
<p>Java Micro Edition</p>
<p>用于嵌入式设备和移动设备上的Java平台</p>
<p>包括了Java虚拟机和一系列的API，如<code>Java ME Connected Limited Device Configuration（CLDC）、Mobile Information Device Profile（MIDP）</code>等。</p>
<p>JavaME支持多种移动设备，如智能手机、平板电脑、数字电视等。</p>
</blockquote>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-41c0b0c1bf0ec7e293777a805b410293"></h1>
	
	<div class="td-byline mb-4">
		
        
	</div>
	<h1 id="lombok">Lombok</h1>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-XML" data-lang="XML"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">&lt;groupId&gt;</span>org.projectlombok<span style="color:#204a87;font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">&lt;artifactId&gt;</span>lombok<span style="color:#204a87;font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h2 id="注解">注解</h2>
<h3 id="data">@Data</h3>
<h3 id="accessors">@Accessors</h3>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-0106f5d1f87398d63e0cd20c3a0efd16">JWT</h1>
	
	<div class="td-byline mb-4">
		作者: <b>XW</b> |
        
	</div>
	<h1 id="jwtjson-web-token">JWT(JSON Web Token)</h1>
<blockquote>
<p><a href="https://jwt.io/">JSON Web Tokens - jwt.io</a></p>
<p>JWT是一种<strong>加密后的数据载体</strong>，可在各应用之间进行数据传输</p>
<p>Token(令牌)</p>
<p><strong>Token的目的是为了减轻服务器的压力，减少频繁的查询数据库，使服务器更加健壮。</strong></p>
</blockquote>
<h2 id="什么是-json-web-token">什么是 JSON Web Token？</h2>
<p>JSON Web Token（JWT） 是一种开放标准 （<a href="https://tools.ietf.org/html/rfc7519">RFC 7519</a>），它定义了一种紧凑且独立的方式，用于在各方之间以 <strong>JSON 对象</strong>的形式<strong>安全地</strong>传输信息。此信息可以验证和信任，因为它是经过<strong>数字签名</strong>的。JWT 可以使用密钥（使用 <strong>HMAC</strong> 算法）或使用 <strong>RSA</strong> 或 <strong>ECDSA</strong> 的公钥/私钥对进行签名。</p>
<blockquote>
<p>JWT涵盖用户身份信息，每次访问时，服务器校验信息合法性</p>
</blockquote>
<h2 id="何时应使用-json-web-token">何时应使用 JSON Web Token？</h2>
<p>以下是 JSON Web Token有用的一些方案：</p>
<ul>
<li><strong>授权</strong>：这是使用 JWT 的最常见方案。<strong>用户登录</strong>后，每个后续请求都将包含 JWT，允许用户访问使用该令牌允许的路由、服务和资源。单点登录是当今广泛使用 JWT 的一项功能，因为它的开销很小，并且能够跨不同域轻松使用。</li>
<li><strong>信息交换</strong>： JSON Web Token是在各方之间安全传输信息的好方法。由于 JWT 可以签名（例如，使用公钥/私钥对），因此您可以确定发件人是他们所说的人。此外，由于签名是使用标头和有效负载计算的，因此您还可以验证内容是否未被篡改。</li>
</ul>
<h2 id="json-web-token结构">JSON Web Token结构</h2>
<blockquote>
<p>一个JWT通常有HEADER(头)，PAYLOAD(有效载荷)和SIGNATURE(签名)三部分组成，之间通过<code>.</code>连接</p>
</blockquote>
<ul>
<li>Header	头(算法和令牌类型)</li>
<li>Payload   有效载荷(数据)</li>
<li>Signature 签名</li>
</ul>
<pre tabindex="0"><code>Header.Payload.Signature
xxxxx.yyyyy.zzzzz
</code></pre><p><strong>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9<code>.</code>eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ<code>.</code>SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c</strong></p>
<h3 id="header-头">Header 头</h3>
<p>JWT的头部包含两部分的信息：</p>
<blockquote>
<ol>
<li>令牌的类型（即 <code>JWT</code>）</li>
<li>使用的加密算法，例如 <code>HMAC SHA256</code> (默认<code>HS256</code>)或 <code>RSA</code>。</li>
</ol>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;alg&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;HS256&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;typ&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;JWT&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p><code>alg</code>：表示签名的算法</p>
<p><code>typ</code>：标识令牌(token)的类型，JWT令牌统一写为<code>JWT</code></p>
<p>使用<code>Base64</code>加密后，构成JWT的第一部分<code>Header</code></p>
<pre tabindex="0"><code></code></pre><h3 id="payload-有效载荷">Payload 有效载荷</h3>
<blockquote>
<p>用于存放实际需要传递的有效信息</p>
</blockquote>
<p><strong>标准载荷</strong>：建议但不强制使用，对JWT信息作补充</p>
<table>
<thead>
<tr>
<th>标准载荷</th>
<th>介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td>iss(issuer)</td>
<td>jwt签发者</td>
</tr>
<tr>
<td>exp(expiration time)</td>
<td>过期时间，必须大于签发时间</td>
</tr>
<tr>
<td>sub(subject)</td>
<td>主题，用来做什么</td>
</tr>
<tr>
<td>aud(audience)</td>
<td>给谁用，接收jwt的一方</td>
</tr>
<tr>
<td>nbf(Not Before)</td>
<td>生效时间</td>
</tr>
<tr>
<td>jti(JWT ID)</td>
<td>JWT的唯一身份标识</td>
</tr>
</tbody>
</table>
<p>自定义载荷：一般添加用户的相关信息 或 其它业务需要的必要信息，不建议添加<strong>敏感信息</strong>(如用户密码)，该部分可在客户端解密</p>
<p><strong>受篡改保护，但任何人都可以读取</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;sub&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;alluser&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;iss&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;zq&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;user_info&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    	<span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;1&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    	<span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;John Doe&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>         <span style="color:#204a87;font-weight:bold">&#34;admin&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>使用Base64加密后，构成JWT第二部分</p>
<pre tabindex="0"><code></code></pre><h3 id="signature-签名">Signature 签名</h3>
<blockquote>
<p>对<strong>前两部分Header、Payload进行签名</strong>，得到一个签名，防止数据篡改</p>
<p>需要指定一个<strong>密钥(secret)</strong>-256-bit，密钥只有服务器知道。(不能泄露)</p>
</blockquote>
<p>使用Header指定的 HMAC SHA256 算法签名：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">signature</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">HMACSHA256</span><span style="color:#ce5c00;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">base64UrlEncode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">header</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34;.&#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">base64UrlEncode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">payload</span><span style="color:#ce5c00;font-weight:bold">),</span><span style="color:#000">secret</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span></code></pre></div><p>使用Base64加密后，构成JWT的第三部分</p>
<h2 id="jwt-token在线编码生成httpstoolttcomjwt-encode"><a href="https://tooltt.com/jwt-encode/">JWT Token在线编码生成</a></h2>
<h3 id="完整json">完整JSON</h3>
<pre tabindex="0"><code>{
  &#34;header&#34;: {
    &#34;alg&#34;: &#34;HS256&#34;,
    &#34;typ&#34;: &#34;JWT&#34;
  },
  &#34;payload&#34;: {
    &#34;data&#34;: [
      {
        &#34;id&#34;: &#34;1&#34;
      },
      {
        &#34;name&#34;: &#34;zq&#34;
      },
      {
        &#34;age&#34;: &#34;20&#34;
      }
    ],
    &#34;iat&#34;: 1690988484,
    &#34;exp&#34;: 1691078398,
    &#34;aud&#34;: &#34;qz&#34;,
    &#34;iss&#34;: &#34;zq&#34;,
    &#34;sub&#34;: &#34;all&#34;
  }
}
</code></pre><h3 id="jwt">JWT</h3>
<pre tabindex="0"><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjpbeyJpZCI6IjEifSx7Im5hbWUiOiJ6cSJ9LHsiYWdlIjoiMjAifV0sImlhdCI6MTY5MDk4ODQ4NCwiZXhwIjoxNjkxMDc4Mzk4LCJhdWQiOiJxeiIsImlzcyI6InpxIiwic3ViIjoiYWxsIn0.abOPHo6ytyaCglKfXgiDPQkcFDdM90FpgX20ktvpBf4
</code></pre><h2 id="jwt特点">JWT特点</h2>
<h3 id="无状态">无状态</h3>
<p>JWT不需要再服务端存取任何状态，客户端而已携带JWT访问服务端，从而使服务端变得无状态，这样，服务端就可以轻松地实现<strong>扩展和负载均衡</strong>。(分布式多台服务器)，只需要校验，不需要存储</p>
<h3 id="可自定义">可自定义</h3>
<p>JWT的有效载荷部分可以自定义，可以存储任何JSON格式的数据。可实现自定义的功能，如用户喜好、配置信息等等。</p>
<h3 id="扩展性强">扩展性强</h3>
<p>JWT有一套标准规范，很容易再不同平台和语言之间共享和解析。开发人员还可以根据需要自定义声明(claims)来实现更加灵活的功能。</p>
<h3 id="调试性好">调试性好</h3>
<p>JWT内容以Base64编码后的字符串形式存在，非常容易进行调试和分析。</p>
<h3 id="安全性取决于密钥管理">安全性取决于密钥管理</h3>
<p>注意密钥的管理，包含生成、存储、更新、分发等等。</p>
<h3 id="无法撤销">无法撤销</h3>
<p>JWT是无状态的，一旦JWT被签发，就无法撤销(除非过期)。如果用户在使用JWT认证期间被注销或禁用，那么服务端就无法阻止该用户继续使用之前签发的JWT。</p>
<p>因此，开发人员需要设计额外的机制来<strong>撤销JWT</strong>，例如使用黑名单、白名单、<strong>加到缓存Redis</strong>(无状态-&gt;有状态) 或者 设置 短期有效期等</p>
<h3 id="需要缓存到客户端">需要缓存到客户端</h3>
<p>JWT包含用户信息和授权信息，需要客户端缓存到本地，意味着JWT有被窃取的风险</p>
<h3 id="载荷大小由限制">载荷大小由限制</h3>
<p>JWT需要传输到客户端，一般不建议超过<strong>1KB</strong>(10个kv对以内)，不然会影响性能</p>
<h2 id="jwt的优缺点">JWT的优缺点</h2>
<h3 id="优点">优点</h3>
<p>无状态性：不需要存储在服务器上，可以实现无状态的身份验证和授权(分布式)</p>
<p>可扩展性：载荷可自定义，可根据需要添加任意信息</p>
<p>可靠性：使用数字签名来保证安全性</p>
<p>平台性：支持多编程语言和操作系统</p>
<p>高效性：不需要查数据库</p>
<h3 id="缺点">缺点</h3>
<p>安全性取决于密钥管理</p>
<p>无法撤销令牌</p>
<p>需要传输到客户端</p>
<p>载荷大小限制</p>
<h2 id="jwt应用场景">JWT应用场景</h2>
<h3 id="一次性验证">一次性验证</h3>
<p>应用场景</p>
<blockquote>
<p>用户注册成功后，发送一份激活邮箱或者其它业务需要邮箱激活等操作。</p>
<p>用户注册账户（填写用户名、密码、邮箱）后，会发送一封邮件给用户的邮箱。邮件里面有个链接，用户点击后，邮箱就被验证了。用户如果没有进行验证的话，是不允许一些操作的，如发表文章（防止恶意注册用户）。</p>
</blockquote>
<p>原因：</p>
<p>时效性：让该链接具有时效性(2小时内激活)</p>
<p>不可篡改性：防止篡改以激活其它账户</p>
<p>邮箱注册</p>
<p><img src="jwt.assets/bV855x.png" alt="后端开发 - 用户邮箱验证实现思路 - 个人文章 - SegmentFault 思否"></p>
<h3 id="restful-api的无状态认证">RESTful API的无状态认证</h3>
<p>做RESTful api的身份凭证：当用户身份校验成功后，客户端每次接口访问都带上JWT，服务端校验JWT合法性(是否篡改/是否过期等)</p>
<h3 id="信息交换">信息交换</h3>
<p>项目间/服务间 之间安全传输信息的好方式，使用公钥（Public Key）与私钥（Private Key），可以确定发件人是他们自称的人。</p>
<blockquote>
<p>公钥（Public Key）与私钥（<a href="https://so.csdn.net/so/search?q=Private&amp;spm=1001.2101.3001.7020">Private</a> Key）是通过一种算法得到的一个密钥对（即一个公钥和一个私钥），<strong>公钥</strong>是密钥对中<strong>公开的部分</strong>，<strong>私钥</strong>则是<strong>非公开的部分</strong>。公钥通常用于<strong>加密会话密钥、验证数字签名，或加密可以用相应的私钥解密</strong>的数据。</p>
<p>公钥和私钥是成对出现的，我们会保留有自己的私钥，同时公开自己的公钥。一个很典型的例子是GitHub的使用。我们通常不会使用账号密码来管理自己的项目，而是通过将自己的<strong>公钥</strong>上传到GitHub的里，而自己的电脑里则保留有相对应的<strong>私钥</strong>，从而达到免密码提交代码。</p>
<p>当然私钥和公钥对是唯一的，而你也可以随时重新生成自己的公钥和私钥密码对，但当你从新生成密钥对并覆盖了就有的密钥时，你之前的公钥就作废了。</p>
<p>简单来说就是：
公钥加密，私钥解密，
私钥签名，公钥验证。</p>
<p><a href="https://blog.csdn.net/u010039377/article/details/79751124">公钥私钥加密和SHA256_sha256密钥_卖鱼的小白菜的博客-CSDN博客</a></p>
</blockquote>
<h3 id="jwt令牌登录">JWT令牌登录</h3>
<blockquote>
<p>JWT令牌存储在客户端，容易泄露并被伪造身份搞破环</p>
<p>JWT被签发，就无法撤销，当破坏在进行时，后端无法马上禁止</p>
</blockquote>
<p>可以通过监控异常JWT访问，设置黑名单+强制下线等方式避免</p>
<h2 id="jwt实战案例">JWT实战案例</h2>
<h3 id="jwt工具类">JWT工具类</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">package</span> <span style="color:#000">com.zq.vaccinum.util</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">com.zq.vaccinum.constant.Constants</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">io.jsonwebtoken.Claims</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">io.jsonwebtoken.Jwts</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">io.jsonwebtoken.io.Decoders</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">io.jsonwebtoken.security.Keys</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">java.util.Date</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">java.util.Map</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"> * JwtToken工具类
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"> * @Author: zq
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"> * @Date: 2023/08/03/0:51
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"> * @Description:
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">JwtTokenUtil</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 生成token令牌
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param claims 数据声明(载荷信息)
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return  token
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">static</span> <span style="color:#000">String</span> <span style="color:#000">createToken</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Map</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">Object</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">claims</span><span style="color:#ce5c00;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">String</span> <span style="color:#000">token</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Jwts</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">builder</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#8f5902;font-style:italic">// 使用默认头
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setClaims</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">claims</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic">// 存放自定义载荷
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setExpiration</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">getExpirationDate</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#8f5902;font-style:italic">// 失效时间
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">signWith</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Keys</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">hmacShaKeyFor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Decoders</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">BASE64</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">decode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Constants</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">JWT_SECRET</span><span style="color:#ce5c00;font-weight:bold">)))</span> <span style="color:#8f5902;font-style:italic">// 签名
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">compact</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">token</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 解析token中的数据声明(载荷信息)
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param token 令牌
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return  数据声明
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">static</span> <span style="color:#000">Claims</span> <span style="color:#000">parseToken</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">token</span><span style="color:#ce5c00;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">Jwts</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">parserBuilder</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSigningKey</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Decoders</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">BASE64</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">decode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Constants</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">JWT_SECRET</span><span style="color:#ce5c00;font-weight:bold">))</span>    <span style="color:#8f5902;font-style:italic">// 签名
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">build</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">parseClaimsJws</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">token</span><span style="color:#ce5c00;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic">// 接收的token令牌
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getBody</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 生成Token失效截至时间
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#204a87;font-weight:bold">static</span> <span style="color:#000">Date</span> <span style="color:#000">getExpirationDate</span><span style="color:#ce5c00;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// 当前系统时间+失效时间
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">Date</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">currentTimeMillis</span><span style="color:#ce5c00;font-weight:bold">()+</span> <span style="color:#000">Constants</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">JWT_EXPIRATION</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 从Token获取用户名
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param token
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">static</span> <span style="color:#000">String</span> <span style="color:#000">getUsernameFromToken</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">token</span><span style="color:#ce5c00;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// parseToken()解析Token获取claims
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">parseToken</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">token</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">getSubject</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 判断token是否失效
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param token
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">static</span> <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">isTokenExpired</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">token</span><span style="color:#ce5c00;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// 判断当前时间是否在时效截止时间内(截止时间是否在当前时间之前)
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">getExpirationDate</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">before</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">Date</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 验证token是否有效(是否修改null,是否过期)
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param token
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">static</span> <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">validateToken</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">token</span><span style="color:#ce5c00;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">parseToken</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">token</span><span style="color:#ce5c00;font-weight:bold">)!=</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span><span style="color:#000">isTokenExpired</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">token</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 刷新token
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param token
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">static</span> <span style="color:#000">String</span> <span style="color:#000">refreshToken</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">token</span><span style="color:#ce5c00;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// 解析token
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#000">Claims</span> <span style="color:#000">claims</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">parseToken</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">token</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// 重置创建时间
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#000">claims</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">put</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Constants</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">JWT_CREATE_TIME</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">Date</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// 生成新的token
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">createToken</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">claims</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 从载体信息中根据key拿值
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param claims  载体信息
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param key  键
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return  值
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">static</span> <span style="color:#000">String</span> <span style="color:#000">getValueByKey</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Claims</span> <span style="color:#000">claims</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">String</span> <span style="color:#000">key</span><span style="color:#ce5c00;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">claims</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">get</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">key</span><span style="color:#ce5c00;font-weight:bold">)!=</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">?</span><span style="color:#000">claims</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">get</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">key</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">toString</span><span style="color:#ce5c00;font-weight:bold">():</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="邮件激活">邮件激活</h3>
<ol>
<li>
<p>/regist注册接口，请求成功后，发送激活链接，链接参数为jwt</p>
</li>
<li>
<p>/active?jwt=激活，接收参数为jwt</p>
</li>
</ol>
<p><a href="https://jwt.io/libraries?language=Java">JSON Web Token Libraries - jwt.io</a></p>
<h3 id="令牌登录">令牌登录</h3>
<ol>
<li>/login登录成功后，返回JWT给客户端</li>
<li>设计<strong>登录检查拦截器</strong>，当访问<strong>其它接口资源</strong>时进行登录拦截</li>
</ol>
<h2 id="jwt指南">JWT指南</h2>
<h3 id="redis校验实现令牌泄露保护">Redis校验实现令牌泄露保护</h3>
<p>在<strong>Redis缓存一份</strong>，判定泄露后(每次进行)，移除Redis中的JWT，当接口再次被发起请求时，强制用户重新进行身份验证</p>
<h3 id="临检jwt限制敏感操">临检JWT限制敏感操</h3>
<blockquote>
<p>一些涉及敏感数据变动时，执行临检操作(不用Redis)。</p>
</blockquote>
<p>在涉及到：<strong>新增、修改、删除、上传、下载</strong>等敏感操作时(支付)，强制检查用户身份，如<strong>手机验证码、扫描二维码</strong>等手段，确认操作者是用户本人</p>
<h3 id="异常jwt监控超频识别与限制">异常JWT监控：超频识别与限制</h3>
<blockquote>
<p>当JWT令牌被盗取，一般会出现<strong>高频次的系统访问</strong>。</p>
</blockquote>
<p>监控用户端在单位时间内的请求次数，当单位时间内的请求<strong>超出预定阈值</strong>时，则判定该用户的JWT令牌异常。(限制访问、冻结、IP限制、封号)</p>
<h3 id="地域检查杜绝jwt泄露可能">地域检查杜绝JWT泄露可能</h3>
<blockquote>
<p>一般用户活动范围是固定的，意味着JWT客户端访问IP相对固定，JWT泄露后，可能会出现异地登录的情况。</p>
</blockquote>
<p>对JWT进行异地访问检查，有效时间内，IP频繁变动可判断JWT泄露。(账号异地登录，邮箱，手机提醒)</p>
<h3 id="客户端区分检查防止jwt泄露">客户端区分检查防止JWT泄露</h3>
<blockquote>
<p>对于APP产品来说，一般客户端是固定的，基本为移动设备(APP，平板)，可以结合设备机器码进行绑定。</p>
</blockquote>
<p>将<strong>JWT与机器码绑定</strong>，存储于服务端，当客户端发起请求时，通过检查客户端的机器码于服务端机器码是否匹配判断JWT是否泄露。(判断JWT可能被盗，机器码不匹配，重新登录)</p>
<h3 id="jwt令牌保护限时限数限频">JWT令牌保护：限时、限数、限频</h3>
<blockquote>
<p>进行泄露识别，做好泄露后补救保证系统安全</p>
</blockquote>
<p>对客户端进行合理限制，限制每个客户端的JWT令牌数量、访问频率、JWT令牌时效等，以降低JWT令牌泄露的风险。</p>
<h2 id="面试题">面试题</h2>
<blockquote>
<p>什么是JWT？解释一下它的结构</p>
</blockquote>
<p>JWT是一种<strong>开放标准</strong>，用于在网络上安全地传输信息。它由三部分组成：<strong>头部、载荷和签名</strong>。</p>
<p>头部包含令牌的元数据，载荷包含实际的信息(用户ID、角色等)，签名用于验证令牌是否被篡改</p>
<blockquote>
<p>JWT的优点是什么? 它与传统的session-based身份验证相比有什么优缺点?</p>
</blockquote>
<p>JWT的优点包括<strong>无状态、可扩展、跨语言、易于实现和良好的安全性</strong>。相比之下，传统的<code>session-based</code>身份验证需要在<strong>服务端维护会话状态</strong>，使得服务端的<strong>负载更高</strong>，并且不<strong>适用于分布式系统</strong>。</p>
<blockquote>
<p>在WT的结构中，分别有哪些部分? 每个部分的作用是什么?</p>
</blockquote>
<p>JWT的结构由三部分组成:头部、载荷和签名。头部包合令牌类型和算法，载荷包含实际的信息，签名由头部、载荷和密钥生成。</p>
<blockquote>
<p>JWT如何工作? 从开始到验证过程的完整流程是怎样的?</p>
</blockquote>
<p>JWT的工作流程分为三个步骤:<strong>生成令牌、发送令牌、验证令牌。</strong></p>
<p>在生成令牌时，服务端使用密钥对头部和载荷进行<strong>签名</strong>。</p>
<p>在发送令牌时，将令牌<strong>发送</strong>给客户端。</p>
<p>在验证令牌时，客户端从令牌中解析出<strong>头部和载荷</strong>，并使用<strong>相同的密钥验证签名</strong>。</p>
<blockquote>
<p>什么是JWT的签名? 为什么需要对]WT进行签名? 如何验证JWT的签名?</p>
</blockquote>
<p>JWT的签名是由<strong>头部、载荷和密钥</strong>生成的，用于验证令牌<strong>是否被算改</strong>。</p>
<p>签名使用<strong>HMAC算法</strong>或<strong>RSA算法</strong>生成。</p>
<p>在验证JWT的签名时，客户端使用相同的<strong>密钥和算法</strong>生成<strong>签名</strong>，并将生成的签名与令牌中的签名<strong>进行比较</strong>。</p>
<blockquote>
<p>什么是IWT的令牌刷新? 为什么需要这个功能?</p>
</blockquote>
<p>令牌刷新是一种<strong>机制</strong>，用于解决<strong>JWT过期</strong>后需要重新登录的问题。在令牌刷新中，服务端生成新的]WT，并将其发送给客户端。客户端使用新的WT替换旧的JWT，从而延长令牌的有效期。</p>
<blockquote>
<p>JWT是否加密?如果是，加密的部分是哪些? 如果不是，那么它如何保证数据安全性?</p>
</blockquote>
<p>JWT本身并不加密，但可以在载荷中包含敏感信息。为了保护这些信息，可以使用<code>]WE (SON Web Encryption)</code>对载荷进行加密。如果不加密，则需要在生成JWT时确保<strong>不在载荷中包含敏感信息</strong>。</p>
<blockquote>
<p>在JWT中，如何处理Token过期的问题? 有哪些方法可以处理?</p>
</blockquote>
<p>JWT过期后，客户端需要重新获取新的WT。可以通过在]WT中包含<strong>过期时间</strong>或使用<code>refresh token</code>等机制来解决过期问题。</p>
<blockquote>
<p>JWT和OAuth2有什么关系? 它们之间有什么区别?</p>
</blockquote>
<p><code>JWT</code>和<code>OAuth2</code>都是用于<strong>身份验证和授权</strong>的<strong>开放标准</strong>。JWT是一种<strong>身份验证机制</strong>，而OAuth2是一种<strong>授权机制</strong>。JWT用于在<strong>不同的系统中安全地传输信息</strong>，OAuth2用于<strong>授权第三方应用程序访问受保护的资源</strong>。</p>
<blockquote>
<p>JWT在什么场景下使用较为合适? 它的局限性是什么?</p>
</blockquote>
<p>JWT在<strong>单体应用或微服务架构</strong>中的使用比较合适。它的局限性包括<strong>无法撤销、令牌较大、无法处理并发</strong>等问题。</p>
<p>在需要针对每次请求进行<strong>访问控制</strong>或<strong>需要撤销令牌</strong>的情况下，JWT可能<strong>不是最佳选择</strong>。</p>
<p>场景应用：<strong>(邮箱激活、令牌登录)</strong></p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-afd7f7b25840af8cd0e8d313baea0879">RESTful</h1>
	
	<div class="td-byline mb-4">
		作者: <b>XW</b> |
        
	</div>
	<h2 id="restful">RESTful</h2>
<blockquote>
<p>7个HTTP方法：GET/POST/PUT/DELETE/PATCH/HEAD/OPTIONS</p>
</blockquote>
<h3 id="接口规范">接口规范</h3>
<blockquote>
<p>增/删/改/查</p>
<p>PSOT/DELETE/PUT/GET</p>
<blockquote>
<p>安全：会不会出现重读、幻读、脏读（数据对不对、数量对不对）</p>
<p>幂等：在操作成功的前提下，会不会对数据库造成额外不好的影响</p>
</blockquote>
</blockquote>
<p><code>GET</code> 查询</p>
<blockquote>
<p>安全且幂等</p>
</blockquote>
<p><code>POST</code> 插入</p>
<blockquote>
<p>不安全且不幂等</p>
<p>不幂等：可能因网络原因，导致插入多条重复记录，但ID不一样</p>
</blockquote>
<p><code>PUT</code> 修改(更新)</p>
<blockquote>
<p>不安全但幂等</p>
<p>幂等：多次操作执行后只存在一个有效结果</p>
</blockquote>
<p><code>DELETE</code> 删除</p>
<blockquote>
<p>不安全但幂等</p>
</blockquote>
<h2 id="curl命令">CURL命令</h2>
<blockquote>
<p>Command Line URL viewer</p>
</blockquote>
<pre tabindex="0"><code># 默认GET请求
curl http://www.baidu.com/
curl -XGET [PATH]
# POST请求
curl -XPOST [PATH]
# 整个请求过程都能看见(请求头、请求体、响应头)
curl -v -XPOST [PATH]
</code></pre><h2 id="heading"></h2>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-ab3aaaa7b66c7c4bce279dd87d4ef870">ruoyi</h1>
	
	<div class="td-byline mb-4">
		作者: <b>XW</b> |
        
	</div>
	<h1 id="若以前后端分离">若以前后端分离</h1>
<h2 id="ruoyihttpdocruoyivip"><a href="http://doc.ruoyi.vip/">RuoYi</a></h2>
<h2 id="配置环境">配置环境</h2>
<p><a href="http://doc.ruoyi.vip/ruoyi/document/hjbs.html#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">环境部署 | RuoYi</a></p>
<ol>
<li>导入数据库</li>
</ol>
<pre tabindex="0"><code>quartz.sql
ry_20230706.sql
</code></pre><ol start="2">
<li>配置mysql数据库连接配置</li>
<li>安装Redis</li>
<li>启动后端项目<code>ruoyi-admin</code></li>
<li>查看前端项目<code>ruoyi-ui</code> 的<code>README.md</code>说明文档</li>
<li>启动前端项目，访问http://localhost:81/</li>
</ol>
<h2 id="启动报错">启动报错</h2>
<blockquote>
<p>原因：Node版本过高</p>
</blockquote>
<p><font color="red"><code>error:03000086:digital envelope routines::initialization error</code></font></p>
<p>解决方法</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 修改环境变量</span>
</span></span><span style="display:flex;"><span><span style="color:#000">$env</span>:NODE_OPTIONS<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;--openssl-legacy-provider&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 启动</span>
</span></span><span style="display:flex;"><span>npm run dev
</span></span></code></pre></div><h2 id="文件结构">文件结构</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>com.ruoyi     
</span></span><span style="display:flex;"><span>├── common            // 工具类
</span></span><span style="display:flex;"><span>│       └── annotation                    // 自定义注解
</span></span><span style="display:flex;"><span>│       └── config                        // 全局配置
</span></span><span style="display:flex;"><span>│       └── constant                      // 通用常量
</span></span><span style="display:flex;"><span>│       └── core                          // 核心控制
</span></span><span style="display:flex;"><span>│       └── enums                         // 通用枚举
</span></span><span style="display:flex;"><span>│       └── exception                     // 通用异常
</span></span><span style="display:flex;"><span>│       └── json                          // JSON数据处理
</span></span><span style="display:flex;"><span>│       └── utils                         // 通用类处理
</span></span><span style="display:flex;"><span>│       └── xss                           // XSS过滤处理
</span></span><span style="display:flex;"><span>├── framework         // 框架核心
</span></span><span style="display:flex;"><span>│       └── aspectj                       // 注解实现
</span></span><span style="display:flex;"><span>│       └── config                        // 系统配置
</span></span><span style="display:flex;"><span>│       └── datasource                    // 数据权限
</span></span><span style="display:flex;"><span>│       └── interceptor                   // 拦截器
</span></span><span style="display:flex;"><span>│       └── manager                       // 异步处理
</span></span><span style="display:flex;"><span>│       └── shiro                         // 权限控制
</span></span><span style="display:flex;"><span>│       └── web                           // 前端控制
</span></span><span style="display:flex;"><span>├── ruoyi-generator   // 代码生成（不用可移除）
</span></span><span style="display:flex;"><span>├── ruoyi-quartz      // 定时任务（不用可移除）
</span></span><span style="display:flex;"><span>├── ruoyi-system      // 系统代码
</span></span><span style="display:flex;"><span>├── ruoyi-admin       // 后台服务
</span></span><span style="display:flex;"><span>├── ruoyi-xxxxxx      // 其他模块
</span></span></code></pre></div><h2 id="登录">登录</h2>
<h3 id="业务层">业务层</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 登录验证
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param username 用户名
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param password 密码
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param code 验证码
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param uuid 唯一标识
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return 结果
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">String</span> <span style="color:#000">login</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">code</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">uuid</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// 验证码校验
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#8f5902;font-style:italic">// 登录前置校验
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#8f5902;font-style:italic">// 用户验证
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#8f5902;font-style:italic">// 生成token返回
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>         
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 校验验证码
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param username 用户名
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param code 验证码
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param uuid 唯一标识
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return 结果
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">validateCaptcha</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">code</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">uuid</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>         <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 登录前置校验
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param username 用户名
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param password 用户密码
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">loginPreCheck</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// 用户名或密码为空 错误
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#8f5902;font-style:italic">// 密码如果不在指定范围内 错误
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#8f5902;font-style:italic">// 用户名不在指定范围内 错误
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#8f5902;font-style:italic">// IP黑名单校验
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        
</span></span><span style="display:flex;"><span>         <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 记录登录信息
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     *
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param userId 用户ID
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">recordLoginInfo</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Long</span> <span style="color:#000">userId</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span></code></pre></div><h3 id="控制层">控制层</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"> * 生成验证码
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@GetMapping</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;/captchaImage&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">AjaxResult</span> <span style="color:#000">getCode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">HttpServletResponse</span> <span style="color:#000">response</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 登录方法
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param loginBody 登录信息
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return 结果
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@PostMapping</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;/login&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">AjaxResult</span> <span style="color:#000">login</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#5c35cc;font-weight:bold">@RequestBody</span> <span style="color:#000">LoginBody</span> <span style="color:#000">loginBody</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 获取用户信息
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return 用户信息
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@GetMapping</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;getInfo&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">AjaxResult</span> <span style="color:#000">getInfo</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 获取路由信息
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return 路由信息
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@GetMapping</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;getRouters&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">AjaxResult</span> <span style="color:#000">getRouters</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span></code></pre></div><h3 id="后端">后端</h3>
<h4 id="验证码生成">验证码生成</h4>
<blockquote>
<p>后端生成一个表达式：1+1=2</p>
</blockquote>
<p><code>1+1=?@2</code></p>
<p><code>@</code>符号分割</p>
<p>验证码显示部分：1+1=?</p>
<p>答案：2	存入Redis</p>
<p>流程：</p>
<ol>
<li>前端发送请求<code>/getCodeImg</code>请求</li>
<li>后端生成验证码和UUID返回给前端</li>
<li>将答案和UUID存放到Redis上</li>
<li>用户输入验证码，发送<code>/login</code>请求(传送<strong>验证码、UUID</strong>信息)</li>
<li>后端拿到<code>UUID</code>查询Redis内验证码进行对比</li>
</ol>
<h4 id="captchacontroller-生成验证码接口">CaptchaController 生成验证码接口</h4>
<p><code>com.ruoyi.web.controller.common.CaptchaController</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"> * 验证码操作处理
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"> * 
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"> * @author ruoyi
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@RestController</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">CaptchaController</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Resource</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;captchaProducer&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">Producer</span> <span style="color:#000">captchaProducer</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Resource</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;captchaProducerMath&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">Producer</span> <span style="color:#000">captchaProducerMath</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">RedisCache</span> <span style="color:#000">redisCache</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">ISysConfigService</span> <span style="color:#000">configService</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 生成验证码
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@GetMapping</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;/captchaImage&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">AjaxResult</span> <span style="color:#000">getCode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">HttpServletResponse</span> <span style="color:#000">response</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">IOException</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">AjaxResult</span> <span style="color:#000">ajax</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">AjaxResult</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">success</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">captchaEnabled</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">configService</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">selectCaptchaEnabled</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">ajax</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">put</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;captchaEnabled&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">captchaEnabled</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(!</span><span style="color:#000">captchaEnabled</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">ajax</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// 保存验证码信息
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#000">String</span> <span style="color:#000">uuid</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">IdUtils</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">simpleUUID</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">String</span> <span style="color:#000">verifyKey</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">CacheConstants</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">CAPTCHA_CODE_KEY</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">uuid</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">String</span> <span style="color:#000">capStr</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">code</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">BufferedImage</span> <span style="color:#000">image</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// 生成验证码
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#000">String</span> <span style="color:#000">captchaType</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">RuoYiConfig</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCaptchaType</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;math&#34;</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">equals</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">captchaType</span><span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">String</span> <span style="color:#000">capText</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">captchaProducerMath</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">createText</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">capStr</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">capText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">substring</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">capText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">lastIndexOf</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;@&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">code</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">capText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">substring</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">capText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">lastIndexOf</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;@&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">image</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">captchaProducerMath</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">createImage</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">capStr</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;char&#34;</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">equals</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">captchaType</span><span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">capStr</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">code</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">captchaProducer</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">createText</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">image</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">captchaProducer</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">createImage</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">capStr</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">redisCache</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setCacheObject</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">verifyKey</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">code</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Constants</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">CAPTCHA_EXPIRATION</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">TimeUnit</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">MINUTES</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// 转换流信息写出
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#000">FastByteArrayOutputStream</span> <span style="color:#000">os</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">FastByteArrayOutputStream</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">try</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">ImageIO</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">write</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;jpg&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">catch</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">IOException</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">AjaxResult</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">error</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getMessage</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">ajax</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">put</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;uuid&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">uuid</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">ajax</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">put</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;img&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Base64</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">encode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">toByteArray</span><span style="color:#ce5c00;font-weight:bold">()));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">ajax</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="登录的具体流程">登录的具体流程</h4>
<blockquote>
<ol>
<li>校验验证码(Redis)</li>
<li>校验用户名和密码(Mysql)</li>
<li>生成Token</li>
</ol>
</blockquote>
<p>使用异步任务管理器，结合线程池，实现异步的操作日志记录，和业务逻辑实现异步解耦合</p>
<h4 id="sysloginservice"><code>SysLoginService</code></h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 登录验证
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param username 用户名
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param password 密码
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param code 验证码
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param uuid 唯一标识
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return 结果
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">String</span> <span style="color:#000">login</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">code</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">uuid</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// 验证码校验
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#000">validateCaptcha</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">code</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">uuid</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// 登录前置校验
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#000">loginPreCheck</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// 用户验证
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#000">Authentication</span> <span style="color:#000">authentication</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">try</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">UsernamePasswordAuthenticationToken</span> <span style="color:#000">authenticationToken</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">UsernamePasswordAuthenticationToken</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">AuthenticationContextHolder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setContext</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">authenticationToken</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic">// 该方法会去调用UserDetailsServiceImpl.loadUserByUsername
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>            <span style="color:#000">authentication</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">authenticationManager</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">authenticate</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">authenticationToken</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">catch</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Exception</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">e</span> <span style="color:#204a87;font-weight:bold">instanceof</span> <span style="color:#000">BadCredentialsException</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">AsyncManager</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">me</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">execute</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">AsyncFactory</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">recordLogininfor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Constants</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">LOGIN_FAIL</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">MessageUtils</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">message</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;user.password.not.match&#34;</span><span style="color:#ce5c00;font-weight:bold">)));</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">throw</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">UserPasswordNotMatchException</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">AsyncManager</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">me</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">execute</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">AsyncFactory</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">recordLogininfor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Constants</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">LOGIN_FAIL</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getMessage</span><span style="color:#ce5c00;font-weight:bold">()));</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">throw</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ServiceException</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getMessage</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">finally</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">AuthenticationContextHolder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">clearContext</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">AsyncManager</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">me</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">execute</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">AsyncFactory</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">recordLogininfor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Constants</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">LOGIN_SUCCESS</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">MessageUtils</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">message</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;user.login.success&#34;</span><span style="color:#ce5c00;font-weight:bold">)));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">LoginUser</span> <span style="color:#000">loginUser</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">LoginUser</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#000">authentication</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getPrincipal</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">recordLoginInfo</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">loginUser</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getUserId</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// 生成token
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">tokenService</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">createToken</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">loginUser</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 校验验证码
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param username 用户名
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param code 验证码
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param uuid 唯一标识
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return 结果
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">validateCaptcha</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">code</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">uuid</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">captchaEnabled</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">configService</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">selectCaptchaEnabled</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">captchaEnabled</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">String</span> <span style="color:#000">verifyKey</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">CacheConstants</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">CAPTCHA_CODE_KEY</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">StringUtils</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">nvl</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">uuid</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">String</span> <span style="color:#000">captcha</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">redisCache</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCacheObject</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">verifyKey</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">redisCache</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">deleteObject</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">verifyKey</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">captcha</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">AsyncManager</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">me</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">execute</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">AsyncFactory</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">recordLogininfor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Constants</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">LOGIN_FAIL</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">MessageUtils</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">message</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;user.jcaptcha.expire&#34;</span><span style="color:#ce5c00;font-weight:bold">)));</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">throw</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">CaptchaExpireException</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(!</span><span style="color:#000">code</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">equalsIgnoreCase</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">captcha</span><span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">AsyncManager</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">me</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">execute</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">AsyncFactory</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">recordLogininfor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Constants</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">LOGIN_FAIL</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">MessageUtils</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">message</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;user.jcaptcha.error&#34;</span><span style="color:#ce5c00;font-weight:bold">)));</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">throw</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">CaptchaException</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="前端">前端</h3>
<h4 id="前端解决跨域问题">前端解决跨域问题</h4>
<blockquote>
<p>调用接口：<code>http://localhost:81/dev-api/captchaImage</code>（调用的前端地址）</p>
<p>前端反向代理解决跨域问题</p>
<p>url请求前端，进行<strong>反向代理</strong>，映射到后端，<strong>解决跨域问题</strong></p>
<ol>
<li>后端解决跨域问题</li>
<li>前端解决跨域问题</li>
</ol>
</blockquote>
<p><a href="https://cloud.tencent.com/developer/article/1924258">https://cloud.tencent.com/developer/article/1924258</a></p>
<p><a href="https://blog.csdn.net/qq_34383510/article/details/115702113">后端接收不到前端传入的header参数信息_请求前端header携带到后端_.猫的树的博客-CSDN博客</a></p>
<p><code>@/vue.config.js</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span> <span style="color:#000">proxy</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#8f5902;font-style:italic">// detail: https://cli.vuejs.org/config/#devserver-proxy
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>      <span style="color:#000;font-weight:bold">[</span><span style="color:#000">process</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">env</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">VUE_APP_BASE_API</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">target</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#4e9a06">`http://localhost:8080`</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">changeOrigin</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// 路径重写，将/dev-api替换为&#39;&#39;再映射到http://localhost:8080
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#8f5902;font-style:italic">// http://localhost:8080/captchaImage
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#000">pathRewrite</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;^&#39;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">process</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">env</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">VUE_APP_BASE_API</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">},</span>
</span></span></code></pre></div><pre tabindex="0"><code>module.exports = {
  publicPath: &#39;./&#39;,
  productionSourceMap: false,
  devServer: {
    proxy: {
      &#39;/api&#39;: {
        target: &#34;http://localhost:8088/vaccinum&#34;, // 访问的后台地址
        changeOrigin: true,
        pathRewrite: { // 重写地址 你的接口地址是&#39;http://10.10.1.10/login&#39; 你请求得时候地址只需要写&#39;/api/login&#39;
          &#39;/api&#39;: &#39;&#39;
        }
      }
    }
  }
};
</code></pre><h4 id="api接口调用">API接口调用</h4>
<ol>
<li><code>@/views/login.vue</code></li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#000">getCode</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">getCodeImg</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">then</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">res</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">captchaEnabled</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">res</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">captchaEnabled</span> <span style="color:#ce5c00;font-weight:bold">===</span> <span style="color:#204a87;font-weight:bold">undefined</span> <span style="color:#ce5c00;font-weight:bold">?</span> <span style="color:#204a87;font-weight:bold">true</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">res</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">captchaEnabled</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">captchaEnabled</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">codeUrl</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;data:image/gif;base64,&#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">res</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">img</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">loginForm</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">uuid</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">res</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">uuid</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">},</span>
</span></span></code></pre></div><ol start="2">
<li><code>@/api/login.js</code></li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// 获取验证码
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">export</span> <span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">getCodeImg</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">request</span><span style="color:#000;font-weight:bold">({</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">url</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;/captchaImage&#39;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">headers</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">isToken</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">method</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;get&#39;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">timeout</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">20000</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><ol start="3">
<li><code>@/utils/request.js</code></li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// 创建axios实例
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">service</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">axios</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">create</span><span style="color:#000;font-weight:bold">({</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8f5902;font-style:italic">// axios中请求配置有baseURL选项，表示请求URL公共部分
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>  <span style="color:#000">baseURL</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">process</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">env</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">VUE_APP_BASE_API</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8f5902;font-style:italic">// 超时
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>  <span style="color:#000">timeout</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">10000</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">})</span>
</span></span></code></pre></div><p><code>ruoyi-ui/.env.development</code>开发环境</p>
<pre tabindex="0"><code># 页面标题
VUE_APP_TITLE = 若依管理系统

# 开发环境配置
ENV = &#39;development&#39;

# 若依管理系统/开发环境
VUE_APP_BASE_API = &#39;/dev-api&#39;

# 路由懒加载
VUE_CLI_BABEL_TRANSPILE_MODULES = true
</code></pre>
</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-ce94205a00302c2292e49c3c5d0504d5">SpringSecurity</h1>
	
	<div class="td-byline mb-4">
		作者: <b>XW</b> |
        
	</div>
	<h2 id="springsecurity">SpringSecurity</h2>
<h3 id="权限管理">权限管理</h3>
<blockquote>
<p>权限管理是管理系统中，针对不同用户对不同<strong>资源</strong>的访问权限进行控制的<strong>过程</strong>。</p>
<p>只有<strong>授权用户</strong>才能访问敏感信息或执行的任务，从而保护系统的安全性和完整性</p>
</blockquote>
<p>权限管理通常包含的步骤：</p>
<ol>
<li>确认用户身份：用户登录，通过用户认证信息来验证用户身份。</li>
<li>为用户分配角色：为每个用户分配一个或多个角色，以确定他们能够访问哪些资源</li>
<li>为用户分配权限：为每个(用户/角色)分配一个或多个权限，以确定他们能够访问哪些资源。RBAC模型中，将权限分配给角色</li>
<li>管理权限：对资源进行权限控制，访问资源的用户必须具备需要的权限才能访问</li>
</ol>
<h3 id="权限管理相关概念">权限管理相关概念</h3>
<h4 id="资源">资源</h4>
<blockquote>
<p>可以是软件系统中任意存在的实体，如：访问目录、文件、数据库中的数据、方法等</p>
<p>在B/S模式中，如：处理请求的方法(Servlet、Controller)、图片、HTML、JS、CSS等</p>
</blockquote>
<h4 id="权限privilege">权限(privilege)</h4>
<blockquote>
<p>B/S模式中，访问某一个URL的权限，在表中储存方式：</p>
</blockquote>
<table>
<thead>
<tr>
<th>ID</th>
<th>权限</th>
<th>资源名称</th>
<th>URL</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>用户管理权限</td>
<td>用户查询</td>
<td>/selectUser</td>
</tr>
<tr>
<td>2</td>
<td>用户管理权限</td>
<td>用户修改</td>
<td>/updateUser</td>
</tr>
<tr>
<td>3</td>
<td>用户管理权限</td>
<td>用户删除</td>
<td>/deleteUser</td>
</tr>
</tbody>
</table>
<blockquote>
<p>资源通常是同URL进行去控制权限，权限对应的某些资源，一个权限可以对应一个资源，也可以对应多个资源</p>
</blockquote>
<p>用户-角色-权限-资源</p>
<h4 id="主体principal">主体(principal)</h4>
<blockquote>
<p>用户，用户拥有账号、密码、角色、权限等基本信息</p>
<p>一个用户具备多个权限</p>
</blockquote>
<h4 id="认证authentication">认证(authentication)</h4>
<blockquote>
<p>认证是权限管理系统判断用户(主体)身份是否合法的过程</p>
<p>用户登录过程</p>
</blockquote>
<p>常见认证方式：账号密码认证、扫码认证、手机短信验证码认证、指纹识别等</p>
<h4 id="授权authorization">授权(authorization)</h4>
<blockquote>
<p>授权是将访问软件系统资源的<strong>权力</strong>授予<strong>主体</strong>的过程</p>
<p>授权通过后，用户具备系统中访问特定功能的能力</p>
<p>通常，<strong>先认证(登录)再授权</strong>，授权一般是为用户授予访问当前资源的权限</p>
</blockquote>
<p>用户登录后，在session中保存用户权限、角色等信息。</p>
<p>用户在访问的时候，服务端获取用户的**权限列表(角色)**判断是否具有访问当前资源的权限（授权）。</p>
<h4 id="权限管理-1">权限管理</h4>
<blockquote>
<p>权限管理是针对主题、全新啊、资源进行统一管理的方式</p>
</blockquote>
<p>用户的权限：系统超级管理员分配 或 升级(达到预期的某种条件)</p>
<h3 id="权限管理的实现">权限管理的实现</h3>
<h4 id="认证流程">认证流程</h4>
<ol>
<li>账号密码</li>
<li>查询用户</li>
<li><strong>用户是否存在</strong></li>
<li><strong>密码是否正确</strong></li>
<li>查询用户具备的权限信息</li>
<li>保存用户的登录状态</li>
<li>登录成功</li>
</ol>
<h4 id="访问控制">访问控制</h4>
<ol start="8">
<li>用户访问<code>/userDetail</code>接口</li>
<li>从请求中获取用户唯一标识</li>
<li>从session中查询用户</li>
<li><strong>用户是否存在</strong>(唯一标识、令牌)</li>
<li><strong>用户是否具备访问当前资源的权限</strong>(权限列表)</li>
<li>放行访问</li>
<li>返回访问的资源</li>
</ol>
<h3 id="rbac模型">RBAC模型</h3>
<h4 id="传统权限模型">传统权限模型</h4>
<p>用户和权限为多对多关系，用中间表维护</p>
<table>
<thead>
<tr>
<th>用户ID</th>
<th>权限ID</th>
</tr>
</thead>
</table>
<p>缺点：操作维护麻烦</p>
<h4 id="rbac模型-1">RBAC模型</h4>
<blockquote>
<p>基于角色的访问控制(Role-Based Access Control)</p>
<p>是一套成熟的权限模型</p>
<p>可以使用权限框架整合RBAC模型实现</p>
</blockquote>
<p>将权限赋予角色，再将角色赋予用户</p>
<p>让维护权限关系的行为变的更加简单</p>
<blockquote>
<p>在RBAC模型设计中，根据权限的复杂程度，可分为<strong>RBAC0、RBAC1、RBAC2、RBAC3</strong>四个级别。</p>
</blockquote>
<p>RBAC0是基础，也叫RBAC模型，RBAC1、RBAC2、RBAC3都是RBAC0为基础的升级。</p>
<p>传统权限模型：</p>
<p>用户——权限</p>
<p>RBAC权限模型：</p>
<p>用户——角色——权限</p>
<h5 id="rbac0">RBAC0</h5>
<blockquote>
<p>用户n——m角色n——m权限(多对多关系)</p>
</blockquote>
<p><strong>用户表—中间表—角色表—中间表—权限表</strong></p>
<h5 id="rbac1">RBAC1</h5>
<blockquote>
<p>在角色中引入继承的概念，将角色分成几个等级，每个等级权限不同，从而实现更细粒度的权限管理</p>
</blockquote>
<p>用户n——m角色(等级1、等级2、等级3)n——m权限(多对多关系)</p>
<p>部门经理细分：经理、副经理</p>
<p>进行细粒度的拆分控制</p>
<h5 id="rbac2">RBAC2</h5>
<blockquote>
<p>仅是对用户、角色和权限三者增加了一些限制。</p>
<p>可分为两类：<strong>静态职责分离SSD</strong>(Static Separation of Duty) 和 <strong>动态职责分离DSD</strong>(Dynamic Separation of Duty)。</p>
</blockquote>
<p><strong>静态职责分离SSD：</strong></p>
<ul>
<li>互斥角色限制：同一个用户在<strong>两个互斥角色</strong>中只能选择<strong>一个</strong>，例如:在为员工分类角色时，<strong>不可以</strong>把<strong>财务</strong>和<strong>出纳</strong>分配给同一个人。</li>
<li>基数限制：一个用户拥有的<strong>角色</strong>是<strong>有限的</strong>，一个角色拥有的<strong>权限</strong>也是<strong>有限的</strong>。这很好理解，<strong>根据实际业务决定</strong>，想想给一个用户无限添加角色、权限也未必是合理的。</li>
<li>先决条件限制：用户想要获得<strong>更高级的角色</strong>，首先必须拥有<strong>低级角色</strong>，这样做的好处就是，<strong>不需要</strong>为高级角色<strong>重新分配</strong>一遍<strong>低级角色</strong>具备的所有权限，例如: 赋予用户部门经理角色，<strong>预先赋予该用户一线员工、小组长等角色</strong>。</li>
</ul>
<p><strong>动态职责分离DSD：</strong></p>
<ul>
<li>
<p>动态的限制用户拥有的角色，比如，一个用户可以拥有多个角色，但<strong>运行时只能激活一个角色</strong></p>
<p>例如：曾经我在某机构做<strong>课程研究员</strong>，登录公司的教学管理平台后，左侧菜单显示的是<strong>课程研究员的权限列表</strong>。当我被派往学院授课，于是我就具备了<strong>讲师的角色</strong>，讲师角色拥有的权限与<strong>课程研究员角色</strong>拥有的权限列表是<strong>不一样的。</strong></p>
<p>并且我如果以<strong>课程研究员</strong>的角色<strong>去操作讲师角色特有的权限</strong>，是不是也<strong>不合适</strong>?</p>
<p>于是在项目的右上角有一个<strong>切换角色的选项</strong>，切换成不同的角色，左侧菜单<strong>显示对应的菜单列表</strong></p>
</li>
</ul>
<h5 id="统一模型rbac3">统一模型RBAC3</h5>
<blockquote>
<p><strong>RBAC3 = RBAC1 + RBAC2</strong></p>
<p>既有角色分层，也包含可以曾各种限制</p>
</blockquote>
<p>只在系统对权限要求非常复杂时，才考虑使用此权限模型</p>
<p>场景：OA办公自动化系统、生产制造</p>
<h4 id="基于rbac的延展用户组">基于RBAC的延展——用户组</h4>
<blockquote>
<p>直接给用户组分配角色，再吧用户加入用户组。(Linux用户组)</p>
<p>用户除了拥有自身的权限外，还拥有了所属用户组的所有权限</p>
</blockquote>
<p>用户——用户组——角色——权限</p>
<h3 id="rbac实现">RBAC实现</h3>
<ul>
<li>手动编码</li>
<li>shiro框架</li>
<li>springSecurity框架</li>
</ul>
<h4 id="rbac数据模型">RBAC数据模型</h4>
<center>用户表user</center>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>字段</th>
<th>类型</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>用户ID</td>
<td>id</td>
<td>int</td>
<td>主键</td>
</tr>
<tr>
<td>用户名</td>
<td>username</td>
<td>varchar(20)</td>
<td>not null</td>
</tr>
<tr>
<td>密码</td>
<td>password</td>
<td>varchar(100)</td>
<td>not null</td>
</tr>
<tr>
<td>电子邮箱</td>
<td>email</td>
<td>varchar(30)</td>
<td>not null</td>
</tr>
</tbody>
</table>
<center>角色表roles</center>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>字段</th>
<th>类型</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>角色ID</td>
<td>id</td>
<td>int</td>
<td>外键</td>
</tr>
<tr>
<td>角色名称</td>
<td>name</td>
<td>varchar(20)</td>
<td>not null</td>
</tr>
</tbody>
</table>
<center>权限表permissions</center>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>字段</th>
<th>类型</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>权限ID</td>
<td>id</td>
<td>int</td>
<td>主键</td>
</tr>
<tr>
<td>权限名称</td>
<td>name</td>
<td>varchar(20)</td>
<td>not null</td>
</tr>
<tr>
<td>权限描述</td>
<td>description</td>
<td>varchar(20)</td>
<td></td>
</tr>
</tbody>
</table>
<center>角色——权限关联表role_permissions</center>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>字段</th>
<th>类型</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>角色ID</td>
<td>role_id</td>
<td>int</td>
<td>外键role(id)</td>
</tr>
<tr>
<td>权限ID</td>
<td>permission_id</td>
<td>int</td>
<td>外键permissions(id)</td>
</tr>
</tbody>
</table>
<center>用户——角色关联表user_roles</center>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>字段</th>
<th>类型</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>用户ID</td>
<td>user_id</td>
<td>int</td>
<td>外键user(id)</td>
</tr>
<tr>
<td>角色ID</td>
<td>role_id</td>
<td>int</td>
<td>外键roles(id)</td>
</tr>
</tbody>
</table>
<p>menu</p>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>字段</th>
<th>类型</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>菜单ID</td>
<td>id</td>
<td>int</td>
<td></td>
</tr>
<tr>
<td>菜单名</td>
<td>menu_name</td>
<td>varchar</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="登录应用">登录应用</h4>
<ol>
<li>用户登录成功后</li>
<li>查询用户角色</li>
<li>查询用户权限</li>
<li>缓存用户数据到<code>Session</code>或<code>Redis</code></li>
<li>用户访问资源，发送token</li>
<li>从redis查询token并获取用户数据</li>
<li>判断访问资源是否受限**(需不需要登录后才能访问)**</li>
<li>受限则判断用户是否具备访问权限，具备则<strong>响应资源</strong>，不具备，<strong>拒绝访问</strong></li>
</ol>
<h4 id="spring-security3x">Spring Security3.X</h4>
<blockquote>
<p>是一个功能强大且高度可定制的<strong>身份认证和访问控制框架</strong>，用于Java应用程序提供<strong>身份认证</strong>和<strong>授权</strong></p>
<p>它是用于保护基于Spring程序的安全框架</p>
</blockquote>
<h5 id="入门">入门</h5>
<p><a href="https://docs.spring.io/spring-security/reference/">Spring Security :: Spring Security</a></p>
<blockquote>
<p>开发环境：<strong>JDK17以上、SpringBoot3.X、SpringSecurity6.X</strong></p>
</blockquote>
<h4 id="spring-security2x">Spring Security2.X</h4>
<p>原理：一个过滤器链</p>
<p>监听器》过滤器链》dispatcherservlet(前置过滤器》mapperHandle》后置拦截器》最终拦截器)</p>
<blockquote>
<p>请求</p>
<ol>
<li>
<p>UsernamePasswordAuthenticationFilter</p>
</li>
<li>
<p>ExceptionTranslationFilter</p>
</li>
<li>
<p>FilterSecurityInterceptor</p>
</li>
</ol>
<p>API</p>
<ol>
<li>
<p>FilterSecurityInterceptor</p>
</li>
<li>
<p>ExceptionTranslationFilter</p>
</li>
<li>
<p>UsernamePasswordAuthenticationFilter</p>
</li>
</ol>
<p>响应</p>
</blockquote>
<p><code>UsernamePasswordAuthenticationFilter</code>：负责处理我们在登录页面填写了用户名密码后的登录请求。(认证)</p>
<p><code>ExceptionTranslationFilter</code>：处理过滤链抛出的任何<code>AccessDeniedException</code>和<code>AutheenticationException</code></p>
<p><code>FilterSecurityInterceptor</code>：负责权限校验的过滤器</p>
<h5 id="认证流程-1">认证流程</h5>
<ol>
<li>
<p><code>UsernamePasswordAuthenticationFilter</code>(重写，登录控制器调用<code>authenticate</code>方法)</p>
</li>
<li>
<p><code>ProviderManager</code>(<code>AuthenticationManager</code>接口)的<code>authenticate</code>方法进行用户认证</p>
</li>
<li>
<p><code>DaoAuthenticationProvider</code> 调用<code>loadUserByUsername</code>方法</p>
</li>
<li>
<p><code>InMenoryUserDetailsManager</code>(<code>UserDetailsService</code>接口)(<code>UserDetailsServiceImpl</code>实现接口重写，从数据库查询)<code>loadUserByUsername</code>方法获取用户信息和用户权限</p>
</li>
</ol>
<p>概念：</p>
<p><code>Authentication</code>接口: 它的实现类，表示当前访问系统的用户，封装了用户相关信息。</p>
<p><code>AuthenticationManager</code>接口: 定义了认证<code>Authentication</code>的方法</p>
<p><code>UserDetailsService</code>接口: 加载用户特定数据的核心接口。里面定义了一个根据用户名查询用户信息的方法。</p>
<p><code>UserDetails</code>接口: 提供核心用户信息，通过<code>UserDetailsService</code>根据用户名获取处理的用户信息要封装成<code>UserDetails</code>对象返回。然后将这些信息封装到<code>Authentication</code>对象中</p>
<p>Jwt认证过滤器</p>
<ol>
<li>
<p>获取token</p>
</li>
<li>
<p>解析token</p>
</li>
<li>
<p>获取<code>userid</code>，从<code>redis</code>中获取用户信息(key:userid value:用户信息)</p>
</li>
<li>
<p>封装<code>Autehntication</code>对象存入<code>SecurityContextHolder</code></p>
</li>
</ol>
<p>其它过滤器</p>
<p>从<code>SecurityContextHolder</code>中获取当前请求用户信息</p>
<h5 id="实战">实战</h5>
<p>登录</p>
<ol>
<li>自定义登录接口，调用ProviderManager的方法进行认证(登录)</li>
<li>自定义UserDetailsService，查询数据库</li>
</ol>
<p>校验</p>
<ol>
<li>自定义Jwt认证过滤</li>
<li>获取token</li>
<li>解析token获取userid</li>
<li>从redis获取用户信息</li>
<li>存入SecurityContextHolder</li>
</ol>
<p>重写<code>UserDetails</code>实现类</p>
<blockquote>
<p><code>UserDetailsService</code>接口<code>loadUserByUsername</code>方法的返回对象</p>
<p>由<code>DaoAuthenticationProvider</code>调用</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@NoArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@AllArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">LoginUser</span> <span style="color:#204a87;font-weight:bold">implements</span> <span style="color:#000">UserDetails</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 用户ID
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">Long</span> <span style="color:#000">userId</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 用户唯一标识
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">String</span> <span style="color:#000">token</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 登录时间
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">Long</span> <span style="color:#000">loginTime</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 过期时间
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">Long</span> <span style="color:#000">expireTime</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 登录IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">String</span> <span style="color:#000">ipaddr</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 登录地点
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">String</span> <span style="color:#000">loginLocation</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 浏览器类型
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">String</span> <span style="color:#000">browser</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 操作系统
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">String</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 权限列表
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">Set</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">permissions</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 用户信息
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">User</span> <span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">Collection</span><span style="color:#ce5c00;font-weight:bold">&lt;?</span> <span style="color:#204a87;font-weight:bold">extends</span> <span style="color:#000">GrantedAuthority</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">getAuthorities</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">String</span> <span style="color:#000">getPassword</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getPassword</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">String</span> <span style="color:#000">getUsername</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getUsername</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">isAccountNonExpired</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">isAccountNonLocked</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">isCredentialsNonExpired</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">isEnabled</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><p>重写<code>UserDetailsService</code>实现类</p>
<blockquote>
<p>原<code>SpringSecurity</code>的实现类是从内存中查询用户信息</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">UserDetailsServiceImpl</span> <span style="color:#204a87;font-weight:bold">implements</span> <span style="color:#000">UserDetailsService</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">UserMapper</span> <span style="color:#000">userMapper</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">UserDetails</span> <span style="color:#000">loadUserByUsername</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">UsernameNotFoundException</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">LambdaQueryWrapper</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">User</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">queryWrapper</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">LambdaQueryWrapper</span><span style="color:#ce5c00;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">queryWrapper</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">eq</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">User</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">getUsername</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// 查询用户信息
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#000">User</span> <span style="color:#000">user</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">userMapper</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">selectOne</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">queryWrapper</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Objects</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">isNull</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">)){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">throw</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">UsernameNotFoundException</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;用户名或者密码错误&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">//TODO 查询用户的权限信息
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// 吧数据封装成UserDetails返回
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#000">LoginUser</span> <span style="color:#000">loginUser</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">LoginUser</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">loginUser</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setUser</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">loginUser</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><h5 id="配置类">配置类</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"> * SpringSecurity配置类
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"> * @Author: zq
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"> * @Date: 2023/08/04/2:14
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"> * @Description:
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@EnableWebSecurity</span> <span style="color:#8f5902;font-style:italic">// 添加 security 过滤器
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#5c35cc;font-weight:bold">@EnableGlobalMethodSecurity</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">prePostEnabled</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#ce5c00;font-weight:bold">)</span>	<span style="color:#8f5902;font-style:italic">// 启用方法级别的权限认证
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">SpringSecurityConfig</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">    * 用户密码加密工具，注入容器
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">    * $2a(bcrypt加密版本号)$10(cost的值) 加密方式+ 盐(22位) + 密文
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">    * $2a$10xxxxx/xxxxx/xxxx
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">    * */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">AuthenticationConfiguration</span> <span style="color:#000">authenticationConfiguration</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">JwtAuthFilter</span> <span style="color:#000">jwtAuthFilter</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// 认证异常处理
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#5c35cc;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">AuthenticationEntryPoint</span> <span style="color:#000">authenticationEntryPoint</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// 授权异常处理
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#5c35cc;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">AccessDeniedHandler</span> <span style="color:#000">accessDeniedHandler</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 获取AuthenticationManager（认证管理器），登录时认证使用
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @throws Exception
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">AuthenticationManager</span> <span style="color:#000">getAuthenticationManagerBean</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">Exception</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">authenticationConfiguration</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getAuthenticationManager</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 用户密码加密方式配置
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">PasswordEncoder</span> <span style="color:#000">getPasswordEncoderBean</span><span style="color:#ce5c00;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">BCryptPasswordEncoder</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 配置类
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @param http
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">SecurityFilterChain</span> <span style="color:#000">filterChain</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">HttpSecurity</span> <span style="color:#000">http</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">Exception</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">http</span>
</span></span><span style="display:flex;"><span>                <span style="color:#8f5902;font-style:italic">// 基于 token，不需要 csrf
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">csrf</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">disable</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#8f5902;font-style:italic">// 基于 token，不需要 session
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">sessionManagement</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">sessionCreationPolicy</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">SessionCreationPolicy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">STATELESS</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">and</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#8f5902;font-style:italic">// 下面开始设置权限
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">authorizeRequests</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">authorize</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">authorize</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#8f5902;font-style:italic">// 请求,允许匿名访问(登录后不能访问)
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>                        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">antMatchers</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;/user/login&#34;</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">anonymous</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">antMatchers</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;/user/register&#34;</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">anonymous</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">antMatchers</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;/captcha/*&#34;</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">anonymous</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">//                        .antMatchers(&#34;/vaccinum-type/list&#34;).permitAll()
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>                        <span style="color:#8f5902;font-style:italic">// 其他地址的访问均需验证权限
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>                        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">anyRequest</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">authenticated</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#8f5902;font-style:italic">// 在 UsernamePasswordAuthenticationFilter.class 过滤器之前
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>                <span style="color:#8f5902;font-style:italic">// 添加 JWT 过滤器，JWT 过滤器在用户名密码认证过滤器之前
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addFilterBefore</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">jwtAuthFilter</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">UsernamePasswordAuthenticationFilter</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">class</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">//                // 认证用户时用户信息加载配置，注入springAuthUserService
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">//                .userDetailsService(userDetailsService)
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">exceptionHandling</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">authenticationEntryPoint</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">authenticationEntryPoint</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">accessDeniedHandler</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">accessDeniedHandler</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">and</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">cors</span><span style="color:#ce5c00;font-weight:bold">()</span>     <span style="color:#8f5902;font-style:italic">// 允许跨域访问
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">and</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">build</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * 配置跨源访问(CORS)
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">//    @Bean
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">//    CorsConfigurationSource corsConfigurationSource() {
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">//        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">//        source.registerCorsConfiguration(&#34;/**&#34;, new CorsConfiguration().applyPermitDefaultValues());
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">//        return source;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">//    }
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">SpringSecurityConfig</span> <span style="color:#204a87;font-weight:bold">extends</span> <span style="color:#000">WebSecurityConfigurerAdapter</span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">    * 用户密码加密工具，注入容器
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">    * */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">PasswordEncoder</span> <span style="color:#000">getPasswordEncoder</span><span style="color:#ce5c00;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">BCryptPasswordEncoder</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><h5 id="密码加密">密码加密</h5>
<p>SpringSeurity默认使用PasswordEncoder，要求数据库密码格式：{id}passowrd，根据id判断密码的加密方式。{noop}明文存储</p>
<p>SpringSeurity推荐使用<code>BCryptPasswordEncoder</code>加密方式</p>
<pre tabindex="0"><code>/**
 * SpringSecurity配置类
 * @Author: zq
 * @Date: 2023/08/04/2:14
 * @Description:
 */
@Configuration
@EnableWebSecurity
public class SpringSecurityConfig {
    /*
    * 用户密码工具
    * */
    @Bean
    public PasswordEncoder getPasswordEncoder(){
        return new BCryptPasswordEncoder();
    }
}
</code></pre><h5 id="jwt验证拦截器">JWT验证拦截器</h5>
<pre tabindex="0"><code>/**
 * 访问验证拦截器
 * @Author: zq
 * @Date: 2023/08/04/2:14
 * @Description:
 */
@Component
public class JwtAuthFilter extends OncePerRequestFilter {

    @Autowired
    private RedisTemplate redisTemplate;

    /*
    * 对用户访问资源的HTTP请求头处理
    * */
    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws IOException, ServletException {
        // 获取请求头的token
        String token = request.getHeader(&#34;token&#34;);
//        if (!request.getMethod().equals(&#34;OPTIONS&#34;)) {
//            token = request.getHeader(&#34;token&#34;);
//            if (!StringUtils.hasText(token)) {
//                token = request.getParameter(&#34;token&#34;);
//                chain.doFilter(request, response);
//                return;
//            }
//        }
        // token为空,放行=&gt;UsernamePasswordAuthenticationFilter,进行登录验证
        if (!StringUtils.hasText(token)) {
            chain.doFilter(request, response);
            return;
        }


        Claims claims = JwtTokenUtil.parseToken(token);
        // 从token里获取Token Key
        String tokenKey = (String) claims.get(Constants.LOGIN_USER_KEY);
        System.out.println(&#34;tokenKey:&#34; + tokenKey);
        // 根据Token Key从redis获取用户信息
        String redisTokenKey = Constants.LOGIN_TOKENS + tokenKey;
        System.out.println(&#34;redisTokenKey:&#34; + tokenKey);
        LoginUser loginUser = (LoginUser) redisTemplate.opsForValue().get(redisTokenKey);
//        LoginUser loginUser = redisCache.getCacheObject(redisTokenKey);
        // 如果redis找不到，说明用户未登录
        if (Objects.isNull(loginUser)){
            throw new UnauthenticatedException(&#34;用户未登录&#34;);
        }
        // 获取权限信息
        Collection&lt;? extends GrantedAuthority&gt; authorities = loginUser.getAuthorities();
        // 用户主体，凭证，是否已验证(默认true)
        UsernamePasswordAuthenticationToken authenticationToken = new UsernamePasswordAuthenticationToken(loginUser, null, authorities);
        // 授权失败，token为空
        if (authenticationToken == null){
            chain.doFilter(request,response);
            return;
        }
        // 如果由授权，放到权限上下文中
        // 将权限信息封装到Authentication中
        SecurityContextHolder.getContext().setAuthentication(authenticationToken);
        chain.doFilter(request,response);
    }

}
</code></pre><h5 id="登录服务">登录服务</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>   <span style="color:#204a87;font-weight:bold">try</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#8f5902;font-style:italic">// 调用authenticate方法进行认证
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>            <span style="color:#8f5902;font-style:italic">// 认证主体(用户名)、凭证(密码)
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>            <span style="color:#000">UsernamePasswordAuthenticationToken</span> <span style="color:#000">authenticationToken</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">UsernamePasswordAuthenticationToken</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic">// AuthenticationManager进行用户认证，该方法会去调用UserDetailsServiceImpl.loadUserByUsername方法
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>            <span style="color:#000">Authentication</span> <span style="color:#000">authenticate</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">authenticationManager</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">authenticate</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">authenticationToken</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">loginUser</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">LoginUser</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#000">authenticate</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getPrincipal</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic">// 认证未通过，会抛出异常
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#ce5c00;font-weight:bold">}</span><span style="color:#204a87;font-weight:bold">catch</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Exception</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">e</span> <span style="color:#204a87;font-weight:bold">instanceof</span> <span style="color:#000">BadCredentialsException</span><span style="color:#ce5c00;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">throw</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">UserPasswordNotMatchException</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><h5 id="登录接口">登录接口</h5>
<p><a href="https://blog.csdn.net/qq_41340258/article/details/125138902">Spring Security 5.7 最新配置细节（直接就能用），WebSecurityConfigurerAdapter 已废弃_websecurityconfigureradapter作废_江帅帅的博客-CSDN博客</a></p>
<pre tabindex="0"><code>// 接口权限设置
@PreAuthorize(&#34;hasAuthority(&#39;sys:user:list&#39;)&#34;)
hasAnyAuthority()
hasRole()  // ROLE_ + d
</code></pre><h5 id="异常处理">异常处理</h5>
<p>认证或者授权的过程出现异常会被：<code>ExceptionTranslationFilter</code>捕获，在<code>ExceptionTranslationFilter</code>会判断是认证失败还是授权失败出现的异常</p>
<p>认证过程中出现的异常：<code>AuthenticationException</code>然后调用<code>AuthenticationEntryPoint</code>对象的方法去进行异常处理</p>
<p>授权过程中出现的异常：<code>AccessDeniedException</code>然后去调用<code>AccessDeniedHandler</code>对象的方法去进行异常处理</p>
<p>自定义实现类</p>
<p>实现<code>AuthenticationEntryPoint</code>和<code>AccessDeniedHandler</code>两个接口</p>
<pre tabindex="0"><code>
/**
 * 认证失败异常处理
 * @Author: zq
 * @Date: 2023/08/08/13:35
 * @Description:
 */
@Component
public class AuthenticationEntryPointImpl implements AuthenticationEntryPoint {
    @Override
    public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException, ServletException {
        JsonResult jsonResult = new JsonResult(Constants.UNAUTHORIZED,&#34;用户认证未通过请重新登录&#34;);
        String json = new ObjectMapper().writeValueAsString(jsonResult);
        WebUtils.renderString(response,json);
    }
}
</code></pre><p>配置给SpringSecurity</p>

</div>





    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="User mailing list" aria-label="User mailing list">
    <a target="_blank" rel="noopener" href="https://example.org/mail" aria-label="User mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Twitter" aria-label="Twitter">
    <a target="_blank" rel="noopener" href="https://example.org/twitter" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Stack Overflow" aria-label="Stack Overflow">
    <a target="_blank" rel="noopener" href="https://example.org/stack" aria-label="Stack Overflow">
      <i class="fab fa-stack-overflow"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-end text-xs-center order-sm-3">
        
        
        
<ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/x-windy/" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Slack" aria-label="Slack">
    <a target="_blank" rel="noopener" href="https://example.org/slack" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Developer mailing list" aria-label="Developer mailing list">
    <a target="_blank" rel="noopener" href="https://example.org/mail" aria-label="Developer mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2">
        <span>&copy; 2023 XW All Rights Reserved</span>
        
        
      </div>
    </div>
  </div>
  
<link rel="stylesheet" href='/shortcodes/plugins-live2d/css/index.css?v=1.0.1' />
<link rel="stylesheet" href='/shortcodes/plugins-live2d/css/waifu.min.css?v=1.0.1' />

<div class= "plugins-live2d-data" data-live2d_width="200" data-live2d_height="220" data-live2d_position="right:10" data-live2d_minwidth="400px"></div>

<script src='/shortcodes/plugins-live2d/js/index.js?v=1.0.1'></script>

</footer>
    </div>
    
  <script src="/js/main.min.9d4be27dd7b0e6c9b2948920085964b72679202e8e0439382ea6a68173e03576.js" integrity="sha256-nUvifdew5smylIkgCFlktyZ5IC6OBDk4LqamgXPgNXY=" crossorigin="anonymous"></script>
<script defer src="/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js" integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin="anonymous"></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>
